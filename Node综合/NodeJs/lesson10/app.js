//?????
var cluster=require("cluster");
var http=require("http");
var child_process=require("child_process");
//cluster.isMaster();?§Ø??????????????
//cluster.isWorker();?§Ø?????????????
//????????????????????
//1?§Ø?cpu????
var os=require("os");
var cpulength=os.cpus().length;
//console.log(cpulength);
if(cpulength<3){
    return
}else{
    //2?§Ø?????????????
    if(cluster.isMaster){//??????
        //console.log("is master");
        //???????????›¯??????????
        var worker=cluster.fork();
        //??????????????????
        worker.send({name:"p-aguai"});
        //????????????
        worker.on("message",function(data){
            console.log(data.name);//c-aguai
        })
    }else{//?????
        //console.log("is worker");
        //???????http???????
        var runserver=child_process.spawn("node",["server.js"]);
        //?????????????????????data
        runserver.stdout.on("data",function(data){
            console.log(data.toString());//listen port at 8090
        });
        //???????????????????????????????????
        process.on("message",function(data){
            console.log(data.name)//p-aguai
            //??????????????????
            process.send({name:"c-aguai"});
        });

    }
}




